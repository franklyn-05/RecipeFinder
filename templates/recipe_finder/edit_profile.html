{% extends 'recipe_finder/base.html' %}

{% block content %}
<div class="container profile-edit-container">
    <div class="edit-profile-header">
        <h1>Edit Your Profile</h1>
        <p>Update your information and personalize your cooking profile</p>
    </div>
    
    <div class="edit-profile-content">
        <div class="profile-form-container">
            <form method="post" enctype="multipart/form-data" class="profile-form">
                {% csrf_token %}
                
                {% if form.errors %}
                    <div class="form-error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="error-content">
                            <h4>Please correct the following errors:</h4>
                            {{ form.errors }}
                        </div>
                    </div>
                {% endif %}
                
                <div class="profile-pic-section">
                    <h3><i class="fas fa-camera"></i> Profile Picture</h3>
                    
                    <div class="profile-pic-upload">
                        <div class="current-pic-preview">
                            {% if profile.profile_pic %}
                                <img src="{{ profile.profile_pic.url }}" alt="Current profile picture" id="profilePicPreview">
                                <div class="pic-overlay">
                                    <i class="fas fa-camera"></i>
                                    <span>Click to change</span>
                                </div>
                            {% else %}
                                <div class="empty-avatar">
                                    <i class="fas fa-user-circle"></i>
                                    <span class="avatar-text">Add a photo</span>
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="upload-controls">
                            <label for="{{ form.profile_pic.id_for_label }}" class="custom-file-upload">
                                <i class="fas fa-cloud-upload-alt"></i> Select image
                            </label>
                            {{ form.profile_pic }}
                            <div class="upload-actions">
                                <p class="upload-help-text">
                                    <i class="fas fa-info-circle"></i> Best practices:
                                    <ul>
                                        <li>Square image (500Ã—500px)</li>
                                        <li>JPEG or PNG format</li>
                                        <li>Max size: 5MB</li>
                                    </ul>
                                </p>
                                {% if profile.profile_pic %}
                                    <button type="button" class="remove-pic-btn" title="Remove current profile picture">
                                        <i class="fas fa-trash-alt"></i> Remove current photo
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section">
                    <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
                    
                    <div class="form-group">
                        <label for="{{ form.bio.id_for_label }}">
                            <i class="fas fa-quote-left"></i> Bio
                        </label>
                        {{ form.bio }}
                        <small class="form-text">Tell the community about yourself and your culinary background</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.location.id_for_label }}">
                            <i class="fas fa-map-marker-alt"></i> Location
                        </label>
                        {{ form.location }}
                        <small class="form-text">City, Country or Region</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.website.id_for_label }}">
                            <i class="fas fa-globe"></i> Website
                        </label>
                        {{ form.website }}
                        <small class="form-text">Your personal blog, social media or professional website</small>
                    </div>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section">
                    <h3><i class="fas fa-utensils"></i> Cooking Profile</h3>
                    
                    <div class="form-group chef-toggle">
                        <label class="switch-label">I am a professional chef</label>
                        <div class="toggle-switch">
                            {{ form.is_chef }}
                            <label for="{{ form.is_chef.id_for_label }}" class="switch"></label>
                        </div>
                        <p class="chef-note">
                            <i class="fas fa-info-circle"></i> 
                            Professional chefs can apply for verification after creating 5 recipes
                        </p>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="save-profile-btn">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="{% url 'profile' %}" class="cancel-btn">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
        
        <div class="profile-edit-sidebar">
            <div class="sidebar-box">
                <h3>Profile Completeness</h3>
                <div class="completeness-meter">
                    <div class="progress-bar">
                        {% with profile_items=0 %}
                            {% if profile.profile_pic %}{% with profile_items=profile_items|add:1 %}{% endwith %}{% endif %}
                            {% if profile.bio %}{% with profile_items=profile_items|add:1 %}{% endwith %}{% endif %}
                            {% if profile.location %}{% with profile_items=profile_items|add:1 %}{% endwith %}{% endif %}
                            {% if profile.website %}{% with profile_items=profile_items|add:1 %}{% endwith %}{% endif %}
                            
                            <div class="progress-fill" style="width: {% widthratio profile_items 4 100 %}%"></div>
                        {% endwith %}
                    </div>
                </div>
                <ul class="profile-tips">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>A complete profile builds trust in the community</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Recipes from complete profiles rank higher in searches</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Add your location to discover local cooking events</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initProfileImageHandling('{{ form.profile_pic.id_for_label }}');
});
</script>
{% endblock %}